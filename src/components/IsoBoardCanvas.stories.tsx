import React from 'react';
import type { Meta, StoryObj } from '@storybook/react';
import { IsoBoardCanvas } from './IsoBoardCanvas';
import type { TileData } from '../core/models/Tile';

const meta: Meta<typeof IsoBoardCanvas> = {
  title: 'IsoBoardLib/Exemplos de Jogos',
  component: IsoBoardCanvas,
  parameters: {
    layout: 'fullscreen',
    docs: {
      description: {
        component: `
# üéÆ IsoBoardLib - Biblioteca para Jogos Isom√©tricos

Uma biblioteca React/Phaser para criar jogos de tabuleiro isom√©tricos com sistema completo de drag & drop, 
eventos, valida√ß√£o e controles de c√¢mera.

## üöÄ Funcionalidades Principais

- **Drag & Drop**: Arraste tiles do invent√°rio para o board
- **Movimenta√ß√£o**: Mova tiles j√° colocados no board
- **Eventos**: Sistema completo de callbacks para todas as a√ß√µes
- **Valida√ß√£o**: Sistema de proximidade e valida√ß√£o de posi√ß√µes
- **C√¢mera**: Controles de pan e zoom
- **Performance**: Otimizado para boards grandes com viewport culling

## üìñ Como Usar

Todas as stories abaixo demonstram diferentes aspectos da biblioteca atrav√©s de exemplos pr√°ticos de jogos.
        `
      }
    }
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

// ==================== TILES DE EXEMPLO ====================

const gameTiles: Record<string, TileData[]> = {
  // Tiles b√°sicos para estrat√©gia
  strategy: [
    {
      id: 'unit-warrior',
      type: 'unit',
      color: 0xff4444,
      metadata: {
        label: '‚öîÔ∏è Guerreiro',
        description: 'Unidade de combate corpo-a-corpo',
        properties: {
          attack: 5,
          defense: 3,
          movement: 2,
          health: 15,
          cost: 3
        }
      }
    },
    {
      id: 'unit-archer',
      type: 'unit', 
      color: 0x44ff44,
      metadata: {
        label: 'üèπ Arqueiro',
        description: 'Unidade de ataque √† dist√¢ncia',
        properties: {
          attack: 4,
          defense: 1,
          movement: 3,
          health: 10,
          range: 3,
          cost: 2
        }
      }
    },
    {
      id: 'building-castle',
      type: 'building',
      color: 0x8B4513,
      metadata: {
        label: 'üè∞ Castelo',
        description: 'Estrutura defensiva principal',
        properties: {
          defense: 10,
          health: 50,
          produces: 'units',
          cost: 10
        }
      }
    }
  ],

  // Tiles de recursos para city-building
  resources: [
    {
      id: 'resource-wood',
      type: 'resource',
      color: 0x8B4513,
      metadata: {
        label: 'ü™µ Madeira',
        description: 'Recurso b√°sico para constru√ß√£o',
        properties: {
          value: 1,
          renewable: true,
          extractionRate: 2
        }
      }
    },
    {
      id: 'resource-stone',
      type: 'resource',
      color: 0x808080,
      metadata: {
        label: 'üóø Pedra',
        description: 'Recurso para constru√ß√µes avan√ßadas',
        properties: {
          value: 2,
          renewable: false,
          extractionRate: 1
        }
      }
    },
    {
      id: 'resource-gold',
      type: 'resource',
      color: 0xFFD700,
      metadata: {
        label: 'üí∞ Ouro',
        description: 'Moeda para com√©rcio e contrata√ß√£o',
        properties: {
          value: 5,
          renewable: false,
          extractionRate: 1
        }
      }
    }
  ],

  // Tiles de terreno
  terrain: [
    {
      id: 'terrain-grass',
      type: 'terrain',
      color: 0x32CD32,
      metadata: {
        label: 'üå± Grama',
        description: 'Terreno b√°sico transit√°vel',
        properties: {
          movementCost: 1,
          buildable: true,
          fertile: true
        }
      }
    },
    {
      id: 'terrain-water',
      type: 'terrain',
      color: 0x4169E1,
      metadata: {
        label: 'üåä √Ågua',
        description: 'Terreno aqu√°tico',
        properties: {
          movementCost: 3,
          buildable: false,
          naval: true
        }
      }
    },
    {
      id: 'terrain-mountain',
      type: 'terrain',
      color: 0x696969,
      metadata: {
        label: '‚õ∞Ô∏è Montanha',
        description: 'Terreno elevado e defensivo',
        properties: {
          movementCost: 2,
          buildable: false,
          defensiveBonus: 2
        }
      }
    }
  ]
};

// ==================== COMPONENTE DE LOG ====================

const GameEventLog: React.FC<{
  events: string[];
  title: string;
  maxHeight?: number;
}> = ({ events, title, maxHeight = 300 }) => (
  <div style={{
    width: '320px',
    background: '#1a1a1a',
    color: 'white',
    padding: '15px',
    borderLeft: '1px solid #333',
    fontFamily: 'monospace',
    fontSize: '12px',
  }}>
    <h3 style={{ color: '#00ff00', margin: '0 0 15px 0', fontSize: '14px' }}>
      üéÆ {title}
    </h3>
    
    <div style={{
      background: '#0a0a0a',
      padding: '10px',
      borderRadius: '4px',
      maxHeight: `${maxHeight}px`,
      overflowY: 'auto',
      fontSize: '11px',
      lineHeight: '1.4',
      border: '1px solid #333'
    }}>
      {events.length === 0 ? (
        <div style={{ color: '#666', fontStyle: 'italic' }}>
          Nenhum evento ainda...
        </div>
      ) : (
        events.map((event, index) => (
          <div key={index} style={{
            color: index === 0 ? '#00ff00' : '#ccc',
            opacity: Math.max(0.4, 1 - (index * 0.05)),
            marginBottom: '3px',
            padding: '2px 0',
            borderBottom: index === 0 ? '1px solid #333' : 'none'
          }}>
            {event}
          </div>
        ))
      )}
    </div>
    
    <div style={{ 
      marginTop: '10px', 
      fontSize: '10px', 
      color: '#666',
      borderTop: '1px solid #333',
      paddingTop: '8px'
    }}>
      üí° Arraste tiles do invent√°rio ou mova tiles do board
    </div>
  </div>
);

// ==================== STORIES ====================

// üìù NOTA IMPORTANTE: Para que o invent√°rio apare√ßa, N√ÉO configure components.inventory
// A l√≥gica √©: shouldShowInventory = !components.inventory
// Se components.inventory for definido (mesmo como {}), o invent√°rio N√ÉO aparece
// Deixe components.inventory undefined para mostrar o invent√°rio automaticamente

export const BasicDragAndDrop: Story = {
  name: 'üéØ B√°sico: Drag & Drop',
  args: {
    boardWidth: 8,
    boardHeight: 6,
    availableTiles: gameTiles.strategy,
  },
  render: (args) => {
    const [events, setEvents] = React.useState<string[]>([]);
    
    const addEvent = (message: string) => {
      const timestamp = new Date().toLocaleTimeString();
      setEvents(prev => [`[${timestamp}] ${message}`, ...prev.slice(0, 19)]);
    };

    return (
      <div style={{ width: '100%', height: '100vh', display: 'flex' }}>
        <div style={{ flex: 1 }}>
          <IsoBoardCanvas
            {...args}
            onDragStart={(event) => {
              addEvent(`üéØ DRAG START: ${event.tile.metadata?.label} (${event.source})`);
            }}
            onDragEnd={(event) => {
              addEvent(`${event.success ? '‚úÖ' : '‚ùå'} DRAG END: ${event.action} - ${event.success ? 'sucesso' : 'cancelado'}`);
            }}
            onTilePlaced={(event) => {
              addEvent(`üéÆ TILE PLACED: ${event.tile.metadata?.label} ‚Üí (${event.boardX}, ${event.boardY})`);
            }}
            onTileHover={(event) => {
              if (event.type === 'tile-hover-start') {
                addEvent(`üëÜ HOVER: ${event.tile.metadata?.label} em (${event.boardX}, ${event.boardY})`);
              }
            }}
            onTileClick={(event) => {
              addEvent(`üñ±Ô∏è CLICK: ${event.tile.metadata?.label} [${event.button}] (${event.clickCount}x)`);
            }}
            components={{
              controlsPanel: { enabled: true },
              tileInfoPopup: { showOnHover: true }
            }}
          />
        </div>
        
        <GameEventLog 
          events={events}
          title="Eventos B√°sicos"
        />
      </div>
    );
  },
  parameters: {
    docs: {
      description: {
        story: `
### üéØ Funcionalidade B√°sica de Drag & Drop

Demonstra as funcionalidades essenciais:

- **Arrastar do Invent√°rio**: Clique e arraste tiles do invent√°rio para o board
- **Mover no Board**: Clique e arraste tiles j√° colocados para nova posi√ß√£o  
- **Eventos**: Todos os eventos s√£o logados em tempo real
- **Hover**: Passe o mouse sobre tiles para ver informa√ß√µes
- **Click**: Clique direito para detalhes, esquerdo para selecionar

**Eventos Dispon√≠veis:**
- \`onDragStart\` - Quando inicia um drag
- \`onDragEnd\` - Quando termina um drag (sucesso ou falha)
- \`onTilePlaced\` - Quando um tile √© colocado no board
- \`onTileHover\` - Quando passa mouse sobre um tile
- \`onTileClick\` - Quando clica em um tile
        `
      }
    }
  }
};

export const StrategyGame: Story = {
  name: '‚öîÔ∏è Jogo de Estrat√©gia',
  args: {
    boardWidth: 10,
    boardHeight: 8,
    availableTiles: gameTiles.strategy,
  },
  render: (args) => {
    const [events, setEvents] = React.useState<string[]>([]);
    const [gameState, setGameState] = React.useState({
      selectedUnit: null as TileData | null,
      turn: 1,
      player: 'Jogador 1',
      resources: { gold: 10, units: 0 }
    });
    
    const addEvent = (message: string) => {
      const timestamp = new Date().toLocaleTimeString();
      setEvents(prev => [`[${timestamp}] ${message}`, ...prev.slice(0, 15)]);
    };

    return (
      <div style={{ width: '100%', height: '100vh', display: 'flex' }}>
        <div style={{ flex: 1 }}>
          <IsoBoardCanvas
            {...args}
            onTilePlaced={(event) => {
              const unit = event.tile;
              const cost = unit.metadata?.properties?.cost || 0;
              
              if (gameState.resources.gold >= cost) {
                setGameState(prev => ({
                  ...prev,
                  resources: {
                    ...prev.resources,
                    gold: prev.resources.gold - cost,
                    units: prev.resources.units + 1
                  }
                }));
                addEvent(`üéñÔ∏è ${unit.metadata?.label} recrutado por ${cost} ouro`);
                addEvent(`üí∞ Ouro restante: ${gameState.resources.gold - cost}`);
              } else {
                addEvent(`‚ùå Ouro insuficiente para ${unit.metadata?.label} (${cost})`);
              }
            }}
            onTileClick={(event) => {
              if (event.button === 'left') {
                setGameState(prev => ({ ...prev, selectedUnit: event.tile }));
                addEvent(`üëÜ Selecionado: ${event.tile.metadata?.label}`);
              } else if (event.button === 'right') {
                const unit = event.tile;
                const props = unit.metadata?.properties;
                addEvent(`üìã ${unit.metadata?.label}: ATK ${props?.attack}, DEF ${props?.defense}, MOV ${props?.movement}`);
              }
            }}
            onDragStart={(event) => {
              if (event.source === 'board') {
                addEvent(`üîÑ Movendo ${event.tile.metadata?.label}`);
              } else {
                addEvent(`üéØ Recrutando ${event.tile.metadata?.label}`);
              }
            }}
            components={{
              controlsPanel: { enabled: true },
              tileInfoPopup: { showOnHover: true, showProperties: true }
            }}
          />
        </div>
        
        <div style={{
          width: '320px',
          background: '#1a1a1a',
          color: 'white',
          padding: '15px',
          borderLeft: '1px solid #333',
          fontFamily: 'monospace',
          fontSize: '12px',
        }}>
          <h3 style={{ color: '#ff6b6b', margin: '0 0 15px 0' }}>
            ‚öîÔ∏è Estado do Jogo
          </h3>
          
          <div style={{ marginBottom: '15px', padding: '10px', background: '#2a2a2a', borderRadius: '4px' }}>
            <div>üèÜ Turno: {gameState.turn}</div>
            <div>üë§ {gameState.player}</div>
            <div>üí∞ Ouro: {gameState.resources.gold}</div>
            <div>üéñÔ∏è Unidades: {gameState.resources.units}</div>
          </div>

          {gameState.selectedUnit && (
            <div style={{ marginBottom: '15px', padding: '10px', background: '#2a4a2a', borderRadius: '4px' }}>
              <div style={{ color: '#4fc3f7', fontWeight: 'bold' }}>üéØ Selecionado:</div>
              <div>{gameState.selectedUnit.metadata?.label}</div>
              <div style={{ fontSize: '10px', color: '#aaa', marginTop: '5px' }}>
                ATK: {gameState.selectedUnit.metadata?.properties?.attack} | 
                DEF: {gameState.selectedUnit.metadata?.properties?.defense} |
                MOV: {gameState.selectedUnit.metadata?.properties?.movement}
              </div>
            </div>
          )}
          
          <h4 style={{ color: '#4fc3f7', margin: '15px 0 10px 0' }}>üìú Log de Batalha</h4>
          <div style={{
            background: '#0a0a0a',
            padding: '10px',
            borderRadius: '4px',
            maxHeight: '250px',
            overflowY: 'auto',
            fontSize: '10px',
            lineHeight: '1.4',
          }}>
            {events.length === 0 ? (
              <div style={{ color: '#666' }}>Aguardando a√ß√µes...</div>
            ) : (
              events.map((event, index) => (
                <div key={index} style={{
                  color: index === 0 ? '#4fc3f7' : '#ccc',
                  opacity: Math.max(0.4, 1 - (index * 0.05)),
                  marginBottom: '2px',
                }}>
                  {event}
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    );
  },
  parameters: {
    docs: {
      description: {
        story: `
### ‚öîÔ∏è Exemplo: Jogo de Estrat√©gia

Demonstra como usar a biblioteca para um jogo de estrat√©gia militar:

**Funcionalidades:**
- **Recrutamento**: Arrastar unidades do invent√°rio gasta ouro
- **Sele√ß√£o**: Clicar em unidades mostra estat√≠sticas  
- **Movimenta√ß√£o**: Arrastar unidades no board para reposicionar
- **Estado do Jogo**: Interface mostra recursos e informa√ß√µes
- **Sistema de Custo**: Cada unidade tem custo em ouro

**Tipos de Unidade:**
- **Guerreiro** ‚öîÔ∏è: Combate corpo-a-corpo (ATK: 5, DEF: 3, MOV: 2)
- **Arqueiro** üèπ: Ataque √† dist√¢ncia (ATK: 4, DEF: 1, MOV: 3, Alcance: 3)  
- **Castelo** üè∞: Estrutura defensiva (DEF: 10, HP: 50)

**Controles:**
- Arrastar do invent√°rio = Recrutar unidade
- Arrastar no board = Mover unidade
- Clique esquerdo = Selecionar
- Clique direito = Ver estat√≠sticas
        `
      }
    }
  }
};

export const CityBuilding: Story = {
  name: 'üèóÔ∏è City Building',
  args: {
    boardWidth: 12,
    boardHeight: 10,
    availableTiles: [...gameTiles.terrain, ...gameTiles.resources],
  },
  render: (args) => {
    const [events, setEvents] = React.useState<string[]>([]);
    const [resources, setResources] = React.useState({
      wood: 10,
      stone: 5,
      gold: 100,
      population: 0
    });
    
    const addEvent = (message: string) => {
      const timestamp = new Date().toLocaleTimeString();
      setEvents(prev => [`[${timestamp}] ${message}`, ...prev.slice(0, 12)]);
    };

    const validatePlacement = (event: any) => {
      const tile = event.draggedTile;
      const nearbyTiles = event.nearbyTiles || [];
      
      if (tile.type === 'resource') {
        // Recursos precisam de terreno adequado
        const hasGoodTerrain = nearbyTiles.some((nearby: any) => 
          nearby.tile.type === 'terrain' && nearby.tile.metadata?.properties?.fertile
        );
        
        if (hasGoodTerrain) {
          addEvent(`‚úÖ Local adequado para ${tile.metadata?.label}`);
        } else {
          addEvent(`‚ö†Ô∏è ${tile.metadata?.label} precisa de terreno f√©rtil pr√≥ximo`);
        }
      }
    };

    return (
      <div style={{ width: '100%', height: '100vh', display: 'flex' }}>
        <div style={{ flex: 1 }}>
          <IsoBoardCanvas
            {...args}
            onTilePlaced={(event) => {
              const tile = event.tile;
              const rate = tile.metadata?.properties?.extractionRate || 0;
              
              if (tile.type === 'resource') {
                addEvent(`üèóÔ∏è ${tile.metadata?.label} constru√≠do em (${event.boardX}, ${event.boardY})`);
                addEvent(`üìà +${rate}/turno de ${tile.metadata?.label.toLowerCase()}`);
              } else if (tile.type === 'terrain') {
                addEvent(`üåç Terreno ${tile.metadata?.label} colocado`);
              }
            }}
            onTileProximity={validatePlacement}
            onTileClick={(event) => {
              if (event.button === 'right') {
                const tile = event.tile;
                const props = tile.metadata?.properties;
                
                if (tile.type === 'resource') {
                  addEvent(`üìä ${tile.metadata?.label}: Valor ${props?.value}, Taxa ${props?.extractionRate}/turno`);
                } else if (tile.type === 'terrain') {
                  addEvent(`üó∫Ô∏è ${tile.metadata?.label}: Custo movimento ${props?.movementCost}, Constru√≠vel: ${props?.buildable ? 'Sim' : 'N√£o'}`);
                }
              }
            }}
            onDragStart={(event) => {
              addEvent(`üéØ Planejando: ${event.tile.metadata?.label}`);
            }}
            components={{
              controlsPanel: { enabled: true, showPosition: true },
              tileInfoPopup: { showOnHover: true, showProperties: true, showDescription: true }
            }}
          />
        </div>
        
        <div style={{
          width: '320px',
          background: '#1a1a1a',
          color: 'white',
          padding: '15px',
          borderLeft: '1px solid #333',
          fontFamily: 'monospace',
          fontSize: '12px',
        }}>
          <h3 style={{ color: '#4fc3f7', margin: '0 0 15px 0' }}>
            üèóÔ∏è Cidade
          </h3>
          
          <div style={{ marginBottom: '15px', padding: '10px', background: '#2a2a2a', borderRadius: '4px' }}>
            <div style={{ color: '#8B4513' }}>ü™µ Madeira: {resources.wood}</div>
            <div style={{ color: '#808080' }}>üóø Pedra: {resources.stone}</div>
            <div style={{ color: '#FFD700' }}>üí∞ Ouro: {resources.gold}</div>
            <div style={{ color: '#87CEEB' }}>üë• Popula√ß√£o: {resources.population}</div>
          </div>

          <div style={{ marginBottom: '15px', padding: '10px', background: '#2a4a2a', borderRadius: '4px' }}>
            <div style={{ color: '#4fc3f7', fontWeight: 'bold', marginBottom: '8px' }}>
              üìã Guia de Constru√ß√£o
            </div>
            <div style={{ fontSize: '10px', lineHeight: '1.4', color: '#ccc' }}>
              ‚Ä¢ üå± Grama: Terreno b√°sico para constru√ß√£o
              <br />
              ‚Ä¢ üåä √Ågua: Navega√ß√£o, n√£o constru√≠vel
              <br />
              ‚Ä¢ ‚õ∞Ô∏è Montanha: Defesa +2, n√£o constru√≠vel
              <br />
              ‚Ä¢ ü™µ Madeira: +2/turno, precisa terreno f√©rtil
              <br />
              ‚Ä¢ üóø Pedra: +1/turno, qualquer terreno
              <br />
              ‚Ä¢ üí∞ Ouro: +1/turno, muito valioso
            </div>
          </div>
          
          <h4 style={{ color: '#4fc3f7', margin: '15px 0 10px 0' }}>üìú Log de Constru√ß√£o</h4>
          <div style={{
            background: '#0a0a0a',
            padding: '10px',
            borderRadius: '4px',
            maxHeight: '200px',
            overflowY: 'auto',
            fontSize: '10px',
            lineHeight: '1.4',
          }}>
            {events.length === 0 ? (
              <div style={{ color: '#666' }}>Comece construindo...</div>
            ) : (
              events.map((event, index) => (
                <div key={index} style={{
                  color: index === 0 ? '#4fc3f7' : '#ccc',
                  opacity: Math.max(0.4, 1 - (index * 0.05)),
                  marginBottom: '2px',
                }}>
                  {event}
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    );
  },
  parameters: {
    docs: {
      description: {
        story: `
### üèóÔ∏è Exemplo: City Building

Demonstra mec√¢nicas de constru√ß√£o de cidade com valida√ß√£o de terreno:

**Funcionalidades:**
- **Terrenos**: Diferentes tipos com propriedades √∫nicas
- **Recursos**: Cada recurso tem taxa de extra√ß√£o e valor
- **Valida√ß√£o**: Sistema de proximidade valida coloca√ß√£o adequada
- **Economia**: Interface mostra recursos acumulados
- **Categorias**: Invent√°rio organizado por tipo

**Sistema de Terreno:**
- **Grama** üå±: Constru√≠vel, f√©rtil para agricultura
- **√Ågua** üåä: Naval, n√£o constru√≠vel
- **Montanha** ‚õ∞Ô∏è: Defensivo, n√£o constru√≠vel

**Sistema de Recursos:**
- **Madeira** ü™µ: Renov√°vel, precisa terreno f√©rtil
- **Pedra** üóø: Finito, qualquer terreno
- **Ouro** üí∞: Valioso, raro
        `
      }
    }
  }
};

export const ProximityValidation: Story = {
  name: 'üîó Sistema de Proximidade',
  args: {
    boardWidth: 8,
    boardHeight: 6,
    availableTiles: gameTiles.strategy,
  },
  render: (args) => {
    const [events, setEvents] = React.useState<string[]>([]);
    const [proximityData, setProximityData] = React.useState<any>(null);
    const [validationFeedback, setValidationFeedback] = React.useState<string>('');
    
    const addEvent = (message: string) => {
      const timestamp = new Date().toLocaleTimeString();
      setEvents(prev => [`[${timestamp}] ${message}`, ...prev.slice(0, 10)]);
    };

    return (
      <div style={{ width: '100%', height: '100vh', display: 'flex' }}>
        <div style={{ flex: 1 }}>
          <IsoBoardCanvas
            {...args}
            onTileProximity={(event) => {
              setProximityData(event);
              const nearbyCount = event.nearbyTiles.length;
              const adjacentCount = event.nearbyTiles.filter(t => t.distance <= 1.5).length;
              
              addEvent(`üîó Proximidade: ${nearbyCount} tiles pr√≥ximos, ${adjacentCount} adjacentes`);
              
              if (event.proximityType === 'adjacent') {
                setValidationFeedback('‚úÖ Posi√ß√£o estrat√©gica - tiles adjacentes encontrados');
              } else if (nearbyCount > 0) {
                setValidationFeedback('‚ö†Ô∏è Posi√ß√£o com apoio - tiles pr√≥ximos');
              } else {
                setValidationFeedback('‚ùå Posi√ß√£o isolada - sem apoio pr√≥ximo');
              }
            }}
            onPositionValidation={(event) => {
              if (event.type === 'position-validation-request') {
                addEvent(`üîç Validando posi√ß√£o (${event.targetPosition.x}, ${event.targetPosition.y})`);
                
                // Simular resposta de valida√ß√£o
                setTimeout(() => {
                  const nearbyCount = event.nearbyTiles.length;
                  const isValid = nearbyCount > 0;
                  
                  // Simular resposta
                  setValidationFeedback(
                    isValid 
                      ? '‚úÖ Posi√ß√£o aprovada pelo sistema' 
                      : '‚ùå Posi√ß√£o rejeitada - isolada demais'
                  );
                }, 200);
              }
            }}
            onTilePlaced={(event) => {
              addEvent(`üéÆ ${event.tile.metadata?.label} colocado em (${event.boardX}, ${event.boardY})`);
              setValidationFeedback('');
              setProximityData(null);
            }}
            onDragStart={(event) => {
              addEvent(`üéØ Iniciando valida√ß√£o para ${event.tile.metadata?.label}`);
            }}
            onDragEnd={(event) => {
              if (!event.success) {
                addEvent(`‚ùå Coloca√ß√£o cancelada`);
                setValidationFeedback('');
                setProximityData(null);
              }
            }}
            components={{
              controlsPanel: { enabled: true },
              tileInfoPopup: { showOnHover: true }
            }}
          />
        </div>
        
        <div style={{
          width: '350px',
          background: '#1a1a1a',
          color: 'white',
          padding: '15px',
          borderLeft: '1px solid #333',
          fontFamily: 'monospace',
          fontSize: '12px',
        }}>
          <h3 style={{ color: '#ff9800', margin: '0 0 15px 0' }}>
            üîó Sistema de Proximidade
          </h3>
          
          {validationFeedback && (
            <div style={{ 
              marginBottom: '15px', 
              padding: '10px', 
              background: validationFeedback.includes('‚úÖ') ? '#1b5e20' : 
                         validationFeedback.includes('‚ö†Ô∏è') ? '#e65100' : '#b71c1c',
              borderRadius: '4px',
              border: '1px solid #333'
            }}>
              <div style={{ fontWeight: 'bold', marginBottom: '5px' }}>üéØ Valida√ß√£o Ativa:</div>
              <div style={{ fontSize: '11px' }}>{validationFeedback}</div>
            </div>
          )}
          
          {proximityData && (
            <div style={{ marginBottom: '15px', padding: '10px', background: '#2a2a2a', borderRadius: '4px' }}>
              <div style={{ color: '#ff9800', fontWeight: 'bold', marginBottom: '8px' }}>
                üìä An√°lise de Proximidade
              </div>
              <div style={{ fontSize: '11px', lineHeight: '1.4' }}>
                <div>üéØ Tile: {proximityData.draggedTile.metadata?.label}</div>
                <div>üìç Posi√ß√£o: ({proximityData.targetPosition.x}, {proximityData.targetPosition.y})</div>
                <div>üìè Raio: {proximityData.radius} tiles</div>
                <div>üîó Tipo: {proximityData.proximityType === 'adjacent' ? 'Adjacente' : 'Pr√≥ximo'}</div>
                <div style={{ marginTop: '8px', color: '#ff9800' }}>
                  üóÇÔ∏è Tiles Pr√≥ximos ({proximityData.nearbyTiles.length}):
                </div>
                {proximityData.nearbyTiles.map((tile: any, index: number) => (
                  <div key={index} style={{
                    fontSize: '10px',
                    color: '#ccc',
                    marginLeft: '8px',
                    marginTop: '3px',
                    padding: '2px 0',
                    borderBottom: '1px solid #333'
                  }}>
                    ‚Ä¢ {tile.tile.metadata?.label} 
                    <span style={{ color: '#888' }}> - {tile.distance.toFixed(1)} tiles</span>
                  </div>
                ))}
              </div>
            </div>
          )}
          
          <div style={{ marginBottom: '15px', padding: '10px', background: '#2a4a2a', borderRadius: '4px' }}>
            <div style={{ color: '#ff9800', fontWeight: 'bold', marginBottom: '8px' }}>
              üìã Como Funciona
            </div>
            <div style={{ fontSize: '10px', lineHeight: '1.4', color: '#ccc' }}>
              1. **Arraste** um tile sobre o board
              <br />
              2. **Sistema detecta** tiles pr√≥ximos automaticamente
              <br />
              3. **Valida√ß√£o** roda em tempo real
              <br />
              4. **Feedback visual** mostra resultado
              <br />
              5. **Eventos** permitem l√≥gica customizada
            </div>
          </div>
          
          <h4 style={{ color: '#ff9800', margin: '15px 0 10px 0' }}>üìú Log de Proximidade</h4>
          <div style={{
            background: '#0a0a0a',
            padding: '10px',
            borderRadius: '4px',
            maxHeight: '200px',
            overflowY: 'auto',
            fontSize: '10px',
            lineHeight: '1.4',
          }}>
            {events.length === 0 ? (
              <div style={{ color: '#666' }}>Arraste um tile para testar...</div>
            ) : (
              events.map((event, index) => (
                <div key={index} style={{
                  color: index === 0 ? '#ff9800' : '#ccc',
                  opacity: Math.max(0.4, 1 - (index * 0.05)),
                  marginBottom: '2px',
                }}>
                  {event}
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    );
  },
  parameters: {
    docs: {
      description: {
        story: `
### üîó Sistema de Proximidade e Valida√ß√£o

Demonstra o sistema avan√ßado de detec√ß√£o de proximidade e valida√ß√£o:

**Funcionalidades:**
- **Detec√ß√£o Autom√°tica**: Detecta tiles pr√≥ximos durante o drag
- **Raio Configur√°vel**: Define dist√¢ncia para detec√ß√£o
- **Tipos de Proximidade**: Adjacent (‚â§1.5) vs Nearby (>1.5)
- **Valida√ß√£o em Tempo Real**: Feedback instant√¢neo durante drag
- **Eventos Customiz√°veis**: \`onTileProximity\` e \`onPositionValidation\`

**Eventos do Sistema:**
- **onTileProximity**: Disparado quando tiles pr√≥ximos s√£o detectados
- **onPositionValidation**: Permite valida√ß√£o customizada de posi√ß√µes
- **Feedback Visual**: Interface mostra resultado da valida√ß√£o

**Casos de Uso:**
- Jogos de estrat√©gia com forma√ß√µes
- Sistemas de constru√ß√£o com requisitos
- Mec√¢nicas de influ√™ncia territorial
- Valida√ß√£o de posicionamento de unidades
        `
      }
    }
  }
};

export const CompleteGameDemo: Story = {
  name: 'üéÆ Demo Completo',
  args: {
    boardWidth: 15,
    boardHeight: 12,
    availableTiles: [...gameTiles.strategy, ...gameTiles.terrain, ...gameTiles.resources],
  },
  render: (args) => {
    const [events, setEvents] = React.useState<string[]>([]);
    const [selectedTile, setSelectedTile] = React.useState<any>(null);
    const [gameMode, setGameMode] = React.useState<'build' | 'battle' | 'resource'>('build');
    
    const addEvent = (message: string) => {
      const timestamp = new Date().toLocaleTimeString();
      setEvents(prev => [`[${timestamp}] ${message}`, ...prev.slice(0, 8)]);
    };

    const modeConfig = {
      build: { color: '#4fc3f7', icon: 'üèóÔ∏è', name: 'Constru√ß√£o' },
      battle: { color: '#f44336', icon: '‚öîÔ∏è', name: 'Batalha' },
      resource: { color: '#4caf50', icon: 'üí∞', name: 'Recursos' }
    };

    return (
      <div style={{ width: '100%', height: '100vh', display: 'flex' }}>
        <div style={{ flex: 1 }}>
          <IsoBoardCanvas
            {...args}
            onTilePlaced={(event) => {
              addEvent(`‚ú® ${event.tile.metadata?.label} colocado`);
            }}
            onTileClick={(event) => {
              setSelectedTile({
                tile: event.tile,
                position: { x: event.boardX, y: event.boardY },
                timestamp: Date.now()
              });
              addEvent(`üëÜ Selecionado: ${event.tile.metadata?.label}`);
            }}
            onDragStart={(event) => {
              const mode = event.tile.type === 'unit' ? 'battle' : 
                          event.tile.type === 'resource' ? 'resource' : 'build';
              setGameMode(mode);
              addEvent(`üéØ Modo: ${modeConfig[mode].name}`);
            }}
            onTileProximity={(event) => {
              const count = event.nearbyTiles.length;
              if (count > 2) {
                addEvent(`üèòÔ∏è √Årea desenvolvida detectada (${count} tiles)`);
              }
            }}
            onCameraMove={(event) => {
              if (event.type === 'camera-move-end') {
                addEvent(`üì∑ C√¢mera reposicionada`);
              }
            }}
            onDragEnd={(event) => {
              if (event.success) {
                addEvent(`‚úÖ A√ß√£o ${modeConfig[gameMode].name.toLowerCase()} conclu√≠da`);
              }
            }}
            components={{
              controlsPanel: { 
                enabled: true,
                showPosition: true,
                showZoom: true,
                showBookmarks: true
              },
              tileInfoPopup: { 
                showOnHover: true, 
                showProperties: true, 
                showDescription: true 
              },
              realtimeDisplay: { 
                enabled: true,
                showFPS: true,
                showTileCount: true
              }
            }}
          />
        </div>
        
        <div style={{
          width: '350px',
          background: '#1a1a1a',
          color: 'white',
          padding: '15px',
          borderLeft: '1px solid #333',
          fontFamily: 'monospace',
          fontSize: '12px',
        }}>
          <h3 style={{ color: '#00ff00', margin: '0 0 15px 0' }}>
            üéÆ Demo Completo
          </h3>
          
          <div style={{ 
            marginBottom: '15px', 
            padding: '10px', 
            background: modeConfig[gameMode].color + '20',
            borderRadius: '4px',
            border: `1px solid ${modeConfig[gameMode].color}`
          }}>
            <div style={{ color: modeConfig[gameMode].color, fontWeight: 'bold' }}>
              {modeConfig[gameMode].icon} Modo: {modeConfig[gameMode].name}
            </div>
            <div style={{ fontSize: '10px', color: '#ccc', marginTop: '5px' }}>
              {gameMode === 'build' && 'Construa terrenos e estruturas'}
              {gameMode === 'battle' && 'Posicione e mova unidades'}
              {gameMode === 'resource' && 'Gerencie recursos e economia'}
            </div>
          </div>

          {selectedTile && (
            <div style={{ marginBottom: '15px', padding: '10px', background: '#2a2a2a', borderRadius: '4px' }}>
              <div style={{ color: '#ffeb3b', fontWeight: 'bold', marginBottom: '5px' }}>
                üéØ Tile Selecionado
              </div>
              <div>{selectedTile.tile.metadata?.label}</div>
              <div style={{ fontSize: '10px', color: '#ccc' }}>
                Posi√ß√£o: ({selectedTile.position.x}, {selectedTile.position.y})
              </div>
              <div style={{ fontSize: '10px', color: '#ccc' }}>
                Tipo: {selectedTile.tile.type}
              </div>
              {selectedTile.tile.metadata?.properties && (
                <div style={{ marginTop: '5px', fontSize: '10px' }}>
                  {Object.entries(selectedTile.tile.metadata.properties).map(([key, value]) => (
                    <div key={key} style={{ color: '#aaa' }}>
                      {key}: {String(value)}
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
          
          <div style={{ marginBottom: '15px', padding: '10px', background: '#2a4a2a', borderRadius: '4px' }}>
            <div style={{ color: '#00ff00', fontWeight: 'bold', marginBottom: '8px' }}>
              üõ†Ô∏è Funcionalidades Ativas
            </div>
            <div style={{ fontSize: '10px', lineHeight: '1.6', color: '#ccc' }}>
              ‚úÖ Drag & Drop completo
              <br />
              ‚úÖ Sistema de proximidade
              <br />
              ‚úÖ Valida√ß√£o em tempo real
              <br />
              ‚úÖ Controles de c√¢mera
              <br />
              ‚úÖ Invent√°rio categorizado
              <br />
              ‚úÖ Popups informativos
              <br />
              ‚úÖ Display de performance
              <br />
              ‚úÖ Sistema de eventos
            </div>
          </div>
          
          <h4 style={{ color: '#00ff00', margin: '15px 0 10px 0' }}>üìú Eventos Recentes</h4>
          <div style={{
            background: '#0a0a0a',
            padding: '10px',
            borderRadius: '4px',
            maxHeight: '180px',
            overflowY: 'auto',
            fontSize: '10px',
            lineHeight: '1.4',
          }}>
            {events.length === 0 ? (
              <div style={{ color: '#666' }}>Interaja com o jogo...</div>
            ) : (
              events.map((event, index) => (
                <div key={index} style={{
                  color: index === 0 ? '#00ff00' : '#ccc',
                  opacity: Math.max(0.4, 1 - (index * 0.05)),
                  marginBottom: '2px',
                }}>
                  {event}
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    );
  },
  parameters: {
    docs: {
      description: {
        story: `
### üéÆ Demo Completo da IsoBoardLib

Esta story demonstra todas as funcionalidades da biblioteca integradas:

**üéØ Funcionalidades Principais:**
- **Drag & Drop**: Sistema completo de arrastar e soltar
- **Movimenta√ß√£o**: Mover tiles j√° posicionados no board  
- **Sele√ß√£o**: Sistema de sele√ß√£o com feedback visual
- **Proximidade**: Detec√ß√£o autom√°tica de tiles pr√≥ximos
- **Valida√ß√£o**: Sistema de valida√ß√£o em tempo real
- **Eventos**: Captura todos os eventos do jogo
- **C√¢mera**: Controles completos de pan e zoom
- **Performance**: Monitoramento em tempo real

**üé® Interface Completa:**
- **Invent√°rio**: Organizado por categorias com busca
- **Controles**: Panel com bookmarks e informa√ß√µes
- **Popups**: Informativos com propriedades detalhadas
- **Performance**: Display de FPS e contadores
- **Estado**: Interface reativa ao estado do jogo

**üéÆ Tipos de Jogo Suportados:**
- Jogos de estrat√©gia militar
- City builders e simuladores
- Jogos de recursos e economia
- Puzzles e quebra-cabe√ßas isom√©tricos
- RPGs t√°ticos

**‚ö° Performance:**
- Viewport culling para boards grandes
- Throttling inteligente de eventos
- Spatial indexing para consultas r√°pidas
- Otimiza√ß√£o autom√°tica baseada no zoom
        `
      }
    }
  }
}; 